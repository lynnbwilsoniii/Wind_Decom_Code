	PROGRAM EMCOPL
C	SOLVES COLD PLASMA DISPERSION EQUATION, NOT ELECTROSTATIC
C	IN STIX'S NOTATION ER IS R,EL IS L,EP IS P,EPERP IS S
C	EPSL IS A
C
	COMPLEX CNU,DN,FN,BN,EPSL,EN2P
	COMPLEX EN2M,XKP,XKM,ERN,ELN,EPN
	COMPLEX ER,EL,EP,EPERP,EPERPN,LAMBDA,ZPL,SQL
 	REAL NU 
C
	DIMENSION WP(10),WC(10),NU(10),A(10),DENS(10),WP2(10)
C	DATA NC /3/
	DATA NC /2/
C	DATA NU /1.E-5,1.E-7,8*0./
c	DATA A /1.,16.,8*1./
C	DATA A /1.,1.986,8*1./
c	DATA DENS /1.,.05,.95,7*1./
c	DATA WCYCL /.02/
C	these are for a check of WHAMP and Oscars
	DATA A /1.,1.,8*1./
C	DATA DENS /1.,1.,.0,7*1./
C	DATA WCYCL /.0085/
C	DATA FP /23.744E3/
	DATA WCYCL /.737/		! B = 335 nT, density = 2
	DATA FP /12.7E3/  		! density = 2
C
c	DATA NC /2/
c	DATA A /1.,1.,8*1./
c	DATA DENS /1.,1.,8*1./
C	DATA NU /1.E-5,1.E-7,8*0./
	DATA NU /10*0./
C He	DATA A /1.,1.,1.986,7*1./		! He
C He	DATA DENS /1.,.9,0.1,7*1./
c	DATA WCYCL /.007/
c	DATA WCYCL /.02/
C	DATA WCYCL /.1/
	DATA TWOPI /6.28318531/
	DATA RSH /13.5/
	DATA ALT /400./
c	DATA FP /22.0E3/
c	DATA COSTK /0./		! 90. deg.
C	DATA COSTK /1./		! 0. deg.
C	DATA COSTK /.9397/		! 20. deg.
c	DATA COSTK /.9848/		! 10. deg.
	DATA COSTK /.999848/		! 1. deg.
C	W,WC,WP2 ARE RATIO TO PLASMA FREQ. OF COMP. 1
C
C	NU(1) = 700.*EXP(-ALT/313.)
C	NU(2) = 70.*EXP(-ALT/87.)
C	NU(3) = 4.*NU(2)
	PRINT 701, ALT,FP,NU(1),NU(2)
 701	FORMAT('0ALT=',F8.1,' KM, FP=',E10.3,' HZ, E,I COLL F',2E10.3)
	PRINT 703, COSTK,(A(N),N=2,NC)
 703	FORMAT(' COS THETA ='F7.4,3X,'ION AT.WTS.',10F5.1)
	PRINT 704,(DENS(N),N=2,NC)
 704	FORMAT(20X,'ION REL.DENS.',10F5.3)
	PRINT 702
 702	FORMAT('0')
  	A(1) = -1./1836.
	DO 11 N = 1,NC
	WP2(N) = DENS(N)/1836./ABS(A(N))
	WC(N) = WCYCL/1836./A(N)
 11	CONTINUE
c	W = 1.25E-7
	W = .1533E-5
	W=W/1.02
c	W = 2.E-6
C	DO 1 NIT = 1,220
	DO 1 NIT = 1,1
c	W=W*1.005
	W=W*1.02
	FHZ = FP*W
C     CALCULATE EPSILON 
      ER = 1. 
      EL = 1. 
      EP = 1. 
      EMAG = 1. 
      DO 10 N = 1,NC  
C     REPLACE M BY M*(1. - I*NU/W)
      CNU = CMPLX(0.,NU(N))/FP/TWOPI
      ER = ER - WP2(N)/W/(W-CNU+WC(N))
      EL = EL - WP2(N)/W/(W-CNU-WC(N))
      EP = EP - WP2(N)/W/(W-CNU)
      EMAG = AMAX1(EMAG,CABS(ER),CABS(EL),CABS(EP)) 
 10   CONTINUE
	ERN = ER/EMAG
	ELN = EL/EMAG
	EPN = EP/EMAG
      EPERPN = .5*(ERN + ELN)
      EPERP = .5*(ER + EL)
	DN = .5*(ERN - ELN)
	SINTK2 = 1. - COSTK**2
	FN = CSQRT(((ERN*ELN-EPN*EPERPN)*SINTK2)**2
     1    + 4.*(EPN*DN*COSTK)**2)
	BN = ERN*ELN*SINTK2 + EPN*EPERPN*(1. + COSTK**2)
	EPSL = EPERP*SINTK2 + EP*COSTK**2
	EN2P = .5*EMAG**2*(BN + FN)/EPSL
	XKP = W*CSQRT(EN2P)
	EN2M = .5*EMAG*(BN - FN)/(EPSL/EMAG)
	XKM = W*CSQRT(EN2M)
	PRINT 700,FHZ,EP,EPERP,ER,EL,EMAG
	PRINT 700,FHZ,EPN,EPERPN,ERN,ELN
	PRINT 700,FHZ,EN2P,XKP,EN2M,XKM
	write(71,700)FHZ,EN2P,EN2M
	write(69,700)FHZ,XKP,XKM
 1	CONTINUE
C     PRINT 100,W,X(1),EPSR,EPS0,EP 
  100 FORMAT(' COPLAS' 8E12.4)  
  700 FORMAT(' 'F12.4,4(E13.4,E12.4),E12.4)
C      RETURN
	STOP
      END 
