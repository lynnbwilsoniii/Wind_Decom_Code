	PROGRAM PROCMKF6
C
C	PROCESSES DATA FROM MAKEFILE6 = SEARCH FOR MAGNETIC FLUCTUATIONS
C		IN TDSS
C
	CHARACTER*120 JUNK
	INTEGER*4 SCETI4(2),ERTDAY
	CHARACTER*1 EVENT
	REAL YY(5000),XX(5000),PP(5000)
C
c 1090	  FORMAT(5X,'DATE,TIME'4X'ERT'4X'EVT NO.','  GLT  '4X'PWR'6X'B2xy',
c     1	  5X,'R21'3X'R31'3X'COSKB'3X'f# ','FREQSP ','  BW  ','FREQRV ',
c     2    ' REV',3X,'fp',2X,'fce',4X,'beta')
c 2037	  FORMAT('  EVT NO.',1X,'EVENT',3x,' DATE,TIME',4X,'P E ',4X,
c     1     'CRITERIA',5X, 'f#',5X,'f Hz',7X,'BW',9X,'PWR',5X,'REVS',1X,
c     2	    ' X RE',2X,'Y RE',2X,'Z RE')
 1091	  FORMAT(' ')
C	at present 1011 is 116 characters
C
c	  WRITE(90,1011) sceti4,ERTDAY,EVENT(1:1),NO_EVT(1),IGL,
c     1	   OBSPWR(5),PX,R21,R31,COSKB,NFMAX,FREQSP,BW,FREQR,REVS,
c     1	   FP,FCE,BETA
 1011   format(I10,I7,I3,A2,I10,I5,2E11.3,F6.3,F6.3,F7.3,I5,F6.1,F6.1,
     1    F6.1,F7.1,F6.1,F6.3,F7.3)
C
c	WRITE(37,1037),NO_EVT(1),EVENT(1:1),SCETI4,ISP,IEV,
c     1	DECIS(N-2,NBXBY),DECIS(N-1,NBXBY),DECIS(N,NBXBY),NFR12,
c     2	OBSFREQ(5),OBSBW(5),OBSPWR(5),revs,XRE,YRE,ZRE
 1037	FORMAT(I10,A2,I10,I9,2I2,3F5.1,I5,3E11.3,F6.1,3F6.1)
c
C
	OPEN(UNIT=90,FILE='FOR090.DAT;20',STATUS='OLD',READONLY)
	OPEN(UNIT=37,FILE='FOR037.DAT;20',STATUS='OLD',READONLY)
	READ(90,1001) JUNK
	READ(90,1001) JUNK
	print*,junk
	READ(90,1001) JUNK
	READ(37,1001) JUNK
	READ(37,1001) JUNK
	print*,junk
	READ(37,1001) JUNK
 1001	FORMAT(A)
	N = 0
C
 100	CONTINUE
C	  WRITE(90,1011) sceti4,ERTDAY,EVENT,NO_EVT,IGL,
	  READ(90,1011,ERR=110,END=200) sceti4,ERTDAY,EVENT,NO_EVT,IGL,
     1	   OBSPWR,PX,R21,R31,COSKB,NFMAX,FREQSP,BW,FREQR,REVS,
     1	   FP,FCE,BETA
C
c	WRITE(37,1037),NO_EVT(1),EVENT(1:1),SCETI4,ISP,IEV,
 110	READ(37,1037,ERR=100,END=200),NO_EVT,EVENT,SCETI4,ISP,IEV,
     1	DECIS1,DECIS2,DECIS3,NFR12,
     2	OBSFREQ,OBSBW,OBSPWR,revs,XRE,YRE,ZRE
	N = N+1
C
C	PX = PX-3.16E-4
	IF(OBSPWR.GT.0..AND.PX.GT.0.) THEN
C	  PRINT*,N,OBSPWR,PX
 	  XX(N) = ALOG10(OBSPWR)
	  YY(N) = ALOG10(PX)
	ELSE
	  PRINT*,-N,OBSPWR,PX
	  N = N-1
	ENDIF
C
	GO TO 100
 200	CONTINUE
	CLOSE(UNIT=90)
	CLOSE(UNIT=37)
	PTTP = 60.
	CALL ANYPLOT(NW,N,PTTP,XX,YY)
	STOP
	END
C
	SUBROUTINE ANYPLOT(NW,NPT,PTTP,XX,YY)
C
	COMMON /MONGOPAR/
     1  X1,X2,Y1,Y2,GX1,GX2,GY1,GY2,LX1,LX2,LY1,LY2,
     1  GX,GY,CX,CY,
     1  EXPAND,ANGLE,LTYPE,LWEIGHT,
     1  CHEIGHT,CWIDTH,CXDEF,CYDEF,PSDEF,PYDEF,COFF,
     1  TERMOUT,XYSWAPPED,NUMDEV,
     1  PI,USERVAR(10),AUTODOT
	INTEGER*4 LX1,LX2,LY1,LY2,LTYPE,LWEIGHT,NUMDEV,DDS
C
	DIMENSION YY(2048),XX(2048),PP(2048)
	CHARACTER*1 DISPOSE
	DATA TWOPI /6.2831853/
C
	ITERM=3
	ITERM=-1
C
	CALL MGOINIT
	CALL MGOSETUP(ITERM)
	CALL MGOERASE
	IF(ITERM.LT.0.) THEN
	  CALL MGOSETLOC(500., 500., 2300., 2300.)
	ELSE
	ENDIF
C
	CALL MGOSETLIM(-9., -9., 2., 2.)
	print*,'npt',npt
C	write(66,*) (nn,xx(nn),yy(nn),nn=2055,2088)
	IF(PTTP.EQ.0.) THEN
	  CALL MGOCONNECT(XX,YY,NPT)
	ELSE
	  CALL MGOPOINTS(PTTP,1,XX,YY,NPT)
	ENDIF

	CALL MGOBOX(1,2)
	CALL MGOXLABEL(6,'OBSPWR')
	CALL MGOYLABEL(10,'B\U2\Dx\Dy')
	CALL MGOPLOTID('[.WIND]PROCMKF6','')
C
	IF(ITERM.LT.0) THEN
	  CALL MGOPRNTPLOT(NVEC)
	  PRINT*,' NO. VECTORS PLOTTED',NVEC
	ELSE
	  READ(5,1023) DISPOSE
 1023	  FORMAT(A1)
	  CALL MGOTCLOSE
	ENDIF
C
	RETURN
	END
	SUBROUTINE ANYHISTO(NW,NPT,PTTP,XX,YY)
C
	COMMON /MONGOPAR/
     1  X1,X2,Y1,Y2,GX1,GX2,GY1,GY2,LX1,LX2,LY1,LY2,
     1  GX,GY,CX,CY,
     1  EXPAND,ANGLE,LTYPE,LWEIGHT,
     1  CHEIGHT,CWIDTH,CXDEF,CYDEF,PSDEF,PYDEF,COFF,
     1  TERMOUT,XYSWAPPED,NUMDEV,
     1  PI,USERVAR(10),AUTODOT
	INTEGER*4 LX1,LX2,LY1,LY2,LTYPE,LWEIGHT,NUMDEV,DDS
C
	DIMENSION YY(2048),XX(2048),PP(2048)
	CHARACTER*1 DISPOSE
	DATA TWOPI /6.2831853/
C
	ITERM=3
	ITERM=-1
C
	CALL MGOINIT
	CALL MGOSETUP(ITERM)
	CALL MGOERASE
	IF(ITERM.LT.0.) THEN
	  CALL MGOSETLOC(500., 500., 2300., 2300.)
	ELSE
	ENDIF
C
	CALL MGOSETLIM(-9., -9., 2., 2.)
	print*,'npt',npt
C	write(66,*) (nn,xx(nn),yy(nn),nn=2055,2088)
	IF(PTTP.EQ.0.) THEN
	  CALL MGOCONNECT(XX,YY,NPT)
	ELSE
	  CALL MGOPOINTS(PTTP,1,XX,YY,NPT)
	ENDIF

	CALL MGOBOX(1,2)
	CALL MGOXLABEL(6,'OBSPWR')
	CALL MGOYLABEL(10,'B\U2\Dx\Dy')
	CALL MGOPLOTID('[.WIND]PROCMKF6','')
C
	IF(ITERM.LT.0) THEN
	  CALL MGOPRNTPLOT(NVEC)
	  PRINT*,' NO. VECTORS PLOTTED',NVEC
	ELSE
	  READ(5,1023) DISPOSE
 1023	  FORMAT(A1)
	  CALL MGOTCLOSE
	ENDIF
C
	RETURN
	END
