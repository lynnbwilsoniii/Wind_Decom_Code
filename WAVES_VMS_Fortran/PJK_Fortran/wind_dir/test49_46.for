	PROGRAM TEST49
C
C	ANALYZES THE OUTPUT OF A TEST 49, FOR PREAMP RESISTANCE
C
C	SO FAR IT WORKS ON A HK OUTPUT PAGE
C
	INTEGER HKW
	CHARACTER*20 FILENM
	EXTERNAL RESFIT
	COMMON /RBLK/ JANT,HKWAV(15,100),RMEAS(3,4),WT(100)
	DIMENSION X(25),Y(25),DX(25)
	DIMENSION MFNO(100),HKW(15,100)
	DATA WT /100*1./
C
	TYPE*,'THIS PROGRAM WORKS ON AN HK OUTPUT PAGE'
	TYPE*,'TO MAKE SUCH A FILE, TYPE "KAG", AND THEN'
	TYPE*,'TYPE "HK/OUTPUT=anyfilename 63,64,65,66,67,70"'
	TYPE*,'SELECT THE DATA FILE AND RUN IN THE USUAL WAY'
	TYPE*,'THEN EDIT THE FILE "anyfilename" SO THAT THE FIRST LINE IS THE'
	TYPE*,'FIRST DESIRED DATA'
	TYPE*,'IF THIS HAS BEEN DONE, TYPE THE FILENAME:'
	READ(5,*) FILENM
C
	OPEN(UNIT=19,NAME=FILENM,TYPE='OLD',READONLY)
 1234	FORMAT(I15,15Z4)
 1235	FORMAT(I15,15I4)
	I=0
 100	CONTINUE
	IS = I
	I=I+1
	READ(19,1234,END=200) MFNO(I),(HKW(J,I),J=1,15)
C	PRINT 1235, MFNO(I),(HKW(J,I),J=1,15)
	GO TO 100
C
 200	CONTINUE
	IA = 0
	DO I = 1,IS,3
	     IA = IA+1
	  DO J=6,13
	     HKWAV(J,IA) = (HKW(J,I)+HKW(J,I+1)+HKW(J,I+2))/3.
	  ENDDO
	ENDDO
	PRINT*,'IS,IA',IS,IA
	DO I = 1,IA
	  PRINT 1236,MFNO(3*I-2),(HKWAV(J,I),J=6,10),HKWAV(13,I)
	ENDDO
 1236	FORMAT(I15,6F7.1)
C
c*****************************
C	FIX UP BAD DATA
	  DO J=6,13
	     HKWAV(J,21) = HKWAV(J,21)*1.5
	  ENDDO
	wt(17) = 0.
c**********************
	X(1) = 128.
	DX(1) = 1.
	X(2) = 20./256.
	DX(2) = .003*X(2)
	JANT = 1
	DO JANT = 1,3
	  X(3) = 1000.
	  IF(JANT.EQ.2) X(3) = 10000.
	  IF(JANT.EQ.3) X(3) = 50.
	  DX(3) = .03*X(3)
	  X(2) = X(2)*X(3)
 	  DO IT = 1,30
	    CALL HUNTMN(3,X,DX,Y,RESFIT,SUMSQ)
C	    PRINT*,JANT,X(1),X(2),X(3),SUMSQ
	  ENDDO
	  X(2) = X(2)/X(3)
	    PRINT*,JANT,X(1),X(2),X(3),SUMSQ
	ENDDO
C	PRINT*,JANT,X(1),X(2),X(3),SUMSQ
C
	STOP
	END
	SUBROUTINE RESFIT(X,SUMSQ)
C
	COMMON /RBLK/ JANT,HKWAV(15,100),RMEAS(3,4),WT(100)
	DIMENSION X(25)
C	IN RMEAS(JANT,IM) JANT = 1,2,3 IS X,Y,Z  IM = 1,2,3,4 IS A,B,C,D
C		LOWEST RESISTANCE TO HIGHEST, IN MEGOHMS
	DATA RMEAS / 31.6,200.,100.,124.8,650.,100.,374.8,1650.,100.,
     1               1024.8,10150.,100./
C
	RANT = X(3)
	SUMSQ = 0.
	COUNT = 1.E-8
	J8 = JANT + 7
	DO I = 1,20      ! TEST HAS 20 LINES, + OFF
C	  IM = MOD(I-1,5) + 1
	  IM = (I-1)/5 + 1
	  ANTVOLTS = (HKWAV(J8,I) - HKWAV(J8,21))*20./256.
	  BIAS = HKWAV(13,I)
	  THVOLTS = X(2)*(BIAS-X(1))/(RANT + RMEAS(JANT,IM))
C	  PRINT*,'I,ANTVOLTS,THVOLTS',I,ANTVOLTS,THVOLTS
	  COUNT = COUNT + WT(I)
	  SUMSQ = SUMSQ + WT(I)*(ANTVOLTS - THVOLTS)**2
	ENDDO
	SUMSQ = SUMSQ/COUNT
	RETURN
	END
