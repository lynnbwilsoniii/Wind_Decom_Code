	SUBROUTINE TIMEFFT
C
C	DOES FFT ON TIME SERIES 'FFT' DATA
C
	COMMON /SPBLK/ PWRW(512),PWRNW(512),FDATA(1024),DATA(1024)
	COMMON /PLOTDT/ ITERM,FFTAVR,NDRV,AMP,IWINDW,STR
	COMMON /WINBLK/ WINDOW(1024)
c
	common /fftblk/ nexpt(1024),ndata(1024)
	common /headblk/ major,minor,ifftch,scet
	character*32 scet
c
	DOUBLE PRECISION GAVR(4),GSTD(4)
	DIMENSION AR(1024),AI(1024),NGHIST(4),OFFS(4,10)
	DATA TWOPI /6.2831853/
	DATA VPSTEP/ .6E-6/              ! VERY ROUGH
	DATA WINDOW /1024*1./
c	DATA OFFS  /2048. ,2048. ,2044. ,2051.,   ! CH 1 GN STP 0-3
c     2             2048. ,2048. ,2046. ,2039.,   ! CH 2 GN STP 0-3
c     3             2048. ,2048. ,2038. ,2047.,   ! etc.
c     4             2048. ,2048. ,2038. ,2048.,
c     5             2048. ,2048. ,2040. ,2043.,
c     6             2048. ,2048. ,2041. ,2063.,
c     7             2032. ,2032. ,2032. ,2032.,
c     8             2035. ,2035. ,2035. ,2035.,
c     9             2033. ,2033. ,2033. ,2033.,
c     X             2250. ,2250. ,2250. ,2250./
	DATA OFFS /40*2048./
C	DATA GAIN(CHANNEL,INPUT)   !  INPUTS ARE ORDERED XYZ,AC, DC, B
C				   !  NO CHANNEL HAS MORE THAN 3 POSS. INPUTS
C
	NP = 10
	NSIZE = 64                        ! FIRST DIMENSION OF PWRL
	NPROS = 2**NP
	NFRQ = NPROS/2
C
C	16 BIT WORDS.  12 LSB'S ARE 0-4095 MANTISSA, THEN 2 BIT EXPONENT
C	THEN 2 BLANK BITS
C
	DAMAX = -1.E7
	DAMIN =  1.E7
	DO IK = 1,1024
	  NTEMP = NDATA(IK).AND.4095
C	  NEXPT(IK) = (NDATA(IK)/2048).AND.3
	  NEX = NEXPT(IK).AND.3
	  TEMP = -(NTEMP-OFFS(NEX+1,IFFTCH))
C	  TEMP = -(NTEMP-2048)
	  DATA(IK) = TEMP*(-16.)**NEX
	  FDATA(IK) = ABS(TEMP)+2048.*NEX
	  IF(DATA(IK).LT.0.) FDATA(IK) = -FDATA(IK)
	  IF(FDATA(IK).GT.DAMAX) THEN
	    MAXEXP = NEXPT(IK)
	    MAXDAT = NDATA(IK)
	    DAMAX = FDATA(IK)
	  ENDIF
	  IF(FDATA(IK).LT.DAMIN) THEN
	    MINEXP = NEXPT(IK)
	    MINDAT = NDATA(IK)
	    DAMIN = FDATA(IK)
	  ENDIF
	ENDDO
	AVR = .5*(MAXDAT + MINDAT)
	DIFF = .5*(MAXDAT - MINDAT)
C
	  DO N = 0,NPROS-1
	    AR(N+1) = VPSTEP*DATA(N+1)
	    AI(N+1) = 0.
	  ENDDO
	  CALL FASFOR(NP,AR,AI,PWRNW)
	  PRINT*,'NO WINDOW,AR1,AI1',AR(1),AI(1)
C	  WRITE(16,*) 'NO WINDOW,AR1,AI1',AR(1),AI(1)
	  FFTAVR = AR(1)/1024.
	  PRINT*, 'AVERAGE FROM OFFSET',FFTAVR
C	  WRITE(16,*) 'AVERAGE FROM OFFSET',FFTAVR
C
C	PWR(NHARM) WILL BE AMP**2/2.
C
	RETURN
	END

