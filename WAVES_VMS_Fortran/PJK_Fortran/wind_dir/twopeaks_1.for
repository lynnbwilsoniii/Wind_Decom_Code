	SUBROUTINE FIT_WAVE(F1,F2,EX1,EY1,EX2,EY2,PH1,PH2,TX1,TY1,
     1	  TX2,TY2,RMSF)
C
C	FITS A PAIR OF WAVES TO THE XYDATA.  INPUTS ARE THE APPARENT
C	FREQUENCIES OF THE WAVES IN KHZ, F1 = X(1), AND F2 = X(1)+X(2)  
C	THE X AND Y COMPONENTS OF
C	THE ELECTRIC VECTORS, X(3) = EX1, EY1, EX2, EY2, AND THEIR PHASES
C	IN RADIANS, X(7) = PH1, PH2
C
	EXTERNAL WAVEFIT,WAVEFIT_T,SUBR
	COMMON /PARTBLK/ X4DATA(2050,4),XRE,YRE,ZRE,SUNCLOCK,SPINRATE
	COMMON /WAVFIT/ N1,N2
	COMMON /SUB_CHOOSE/ NVAR
	COMMON /FREQ_CHOOSE/ FREQMAX
	COMMON /HNTBLK/ NHUNT(25)
	COMMON /XYBLOCK/ XSPECT,YSPECT,DPHASE
	COMMON /ANGLEBLK/ BANGLE,IAANGLE
	common /headblk/ major,minor,s_scet
	COMMON /HEADBL/ PTITLE,EVENT,NUMEVENT,FILE
	CHARACTER*12 PTITLE(20)
	CHARACTER*4 EVENT
	CHARACTER*80 FILE
	INTEGER*4 SUNCLOCK,S_SCET(2)
	REAL 	XSPECT(1025),YSPECT(1025),DPHASE(1025)
	REAL 	X(25),DX(25),Y(25),XS(25),XB(25)
c
	DATA XLEN,YLEN,ZLEN /.0411, .00379, .00217/             ! KM, FOR mV
	DATA TWOPI /6.28318531/
	DATA SPS /120000./      !***************** WARNING ******
C
	SECT = 10.84
	SECT = 8.5
c	SECT = 1
	NSECT = SECT + .5
	N2 = 1
	DO ISECT = 1,NSECT
	  N1 = N2
	  N2 = N1 + (2048./SECT + .5)
	  N2 = MIN0(N2,2048)
C
c	  N2 = 1536
c	  N1 = 512
C	  N2 = 2048
C	  N1 = 844
C	  N1= 1355
C	  N1 = 1145
C	  N1 = 1626
C
	  DO N = 3,6
	    NHUNT(N) = 0
	    NHUNT(N+6) = 0
	  ENDDO
C	  NVAR = 8
c	  NVAR = 9
	  NVAR = 12
C
	  IF(NVAR.EQ.9) NHUNT(9) = 1
	  IF(NVAR.GE.10) THEN			! NO NEED OF PHI
	    NHUNT(7) = 0
	    NHUNT(8) = 0
	    X(7) = 0.
	    X(8) = 0.
	  ENDIF
C
C	  FIND MAXIMUM IN SPECTRUM
C
	  SMAX = -1000.
	  DO N = 10,1022
	    IF(XSPECT(N).GT.SMAX) THEN
	      SMAX = XSPECT(N)
	      NSPMAX = N
	    ENDIF
	  ENDDO
	PRINT*,'X SPECTRUM MAX:N,F,SMAX',NSPMAX,(NSPMAX-1)*SPS/2048.,SMAX
	  FREQMAX = (NSPMAX-1)*SPS/2048.
C	  AVERAGE OVER ADJACENT POINTS
	  FTOT = 0.
	  STOT = 0.
	  DO NN = -1,1
	    FNN = (NSPMAX-1+NN)*SPS/2048.
	    SNN = 10.**(.1*XSPECT(NSPMAX+NN))
	    FTOT = FTOT+FNN*SNN
	    STOT = STOT+SNN
	  ENDDO
	  FREQMAX = FTOT/STOT
	  PRINT*,'INTERPOLATED FREQ',FREQMAX
	  WRITE(76,*) 'INTERPOLATED FREQ',FREQMAX
C	  FREQMAX = 4.04*1000.
C	  X(2) = 37.
C	  PRINT*,'CHANGE TO ',FREQMAX,'  X(2) =',X(2)
C
	  DO N = 10,1022
	    IF(XSPECT(N).GT.(SMAX-20.)) THEN
	    PRINT*,'OTHER LARGE SIGS:N,F,SMAX',N,(N-1)*SPS/2048.,XSPECT(N)
	    WRITE(76,*) 'OTHER LARGE SIGS:N,F,SMAX',N,(N-1)*SPS/2048.,
     1		XSPECT(N)
	    ENDIF
	  ENDDO
C
C	  find second largest signal
C
	  SMAX2 = -1000.
	  DO N = 10,1022
	    IF(XSPECT(N).GT.SMAX2.AND.N.NE.NSPMAX) THEN
	      SMAX2 = XSPECT(N)
	      NSPMAX2 = N
	    ENDIF
	  ENDDO
	  PRINT*,'2ND X SPECTRUM MAX:N,F,SMAX',NSPMAX2,
     1		(NSPMAX2-1)*SPS/2048.,SMAX2
	nhunt(1) = 0
	nhunt(2) = 0
	PRINT*,'FREQMAX',FREQMAX
	WRITE(76,*) 'FREQMAX',FREQMAX
	F1 = .001*FREQMAX		! CHANGE TO KHZ
c	x(2) = .73			! 1592709
C	x(2) = -.95			! 7118850
	IF(IABS(NSPMAX-NSPMAX2).GT.1) THEN
	  x(2) = (NSPMAX2-NSPMAX)*SPS/2048000.
	ENDIF
	write(76,*) 'second peak, delta f = X(2) =',x(2)
C*******
C	x(2) = .284			! 12304329
c	x(2) = 1.46			! 12304248 ON 1995 APR 17
C	x(2) = 1.			! 12304248 ON 1995 APR 17
C*********

