	PROGRAM SPIKEPROC
C
C	PROCESSES FILES FOR070.DAT OR MAKEFILE24.RESULTS, ON SPIKES
C
	INTEGER*4 SCETI4(2),TMDAY,SUNCLOCK
	CHARACTER*2 EVENTT
	CHARACTER*4 EVENT
	REAL HIST(200,4)
C
	DATA HIST /800*0./
	DATA DPUCLK /0/
C
C	FOR FOR070.DAT, ROUGHLY EQUAL POSITIVE AND NEGATIVE SPIKES
C
	OPEN(UNIT=70,FILE='FOR070.DAT',STATUS='OLD',READONLY)
	NREAD=0
 100	CONTINUE
C
C	THE FOLLOWING IS FOR THE FIRST RUN
C	READ(70,1011,ERR=100,END=200) SCETI4,NOEVTT,TMDAY,EVENTT,
C	READ(70,1011,ERR=101,END=200) SCETI4,NOEVTT,TMDAY,EVENTT,
C     1	  APK1P,NWPK1P,APK1N,NWPK1N,APK2P,NWPK2P,APK2N,NWPK2N,
C     2    SUNCLOCK,MAJOR,MINOR,DPUCLK
C 1011	format(I10,I7,I10,I3,A2,F7.2,I4,F7.2,I4,F9.2,I4,F7.2,I4,I7,I8,
C     1   I5,F11.1)
C
C	THE FOLLOWING IS FOR THE SECOND RUN, FOR070.DAT;
C	READ(70,1011) sceti4,NOEVTT,TMDAY,EVENTT,APK1P,NWPK1P,
C     1  APK1N,NWPK1N,APK2P,NWPK2P,APK2N,NWPK2N,NLAG1,NLAG2,SUNCLOCK,
C     1  PANGLE,ZANGLE,COSCC,COSBE,EPT
C	at present 1011 is 127 characters
C 1011	format(I10,I7,I10,I3,A2,F7.2,I4,F8.2,I4,F9.2,I4,F8.2,I4,I5,I5,
C     1   I6,F6.0,F6.0,F6.2,F6.2,F6.3)
c	print*,sceti4
c	print*,'nwpk2p',nwpk2p
c	print*,'lags',nlag1,nlag2
c	print*,'sunclock',sunclock
c	print*,'angles',pangle,zangle
c	print*,'ept',ept
C
C	THE FOLLOWING IS FOR THE THIRD RUN, FOR070.DAT;37
	READ(70,1011,ERR=101,END=200) sceti4,NOEVTT,TMDAY,EVENTT,APK1P,NWPK1P,
     1  APK1N,NWPK1N,APK2P,NWPK2P,APK2N,NWPK2N,NLAG1,NLAG2,SUNCLOCK,
     1  PANGLE,ZANGLE,FCHANGE,ANGDD,EPT
C	at present 1011 is 127 characters
 1011	format(I10,I7,I10,I3,A2,F7.2,I4,F8.2,I4,F9.2,I4,F8.2,I4,I6,I5,
     1   I5,F6.0,F6.0,F6.2,F6.1,F6.3)
C
C	FOR FOR071.DAT, ONE SIDED SPIKES
C
C	OPEN(UNIT=71,FILE='FOR071.DAT',STATUS='OLD',READONLY)
C	NREAD=0
C 100	CONTINUE
C	READ(71,1012,ERR=101,END=200) sceti4,NOEVTT,TMDAY,EVENTT,
C     1    APK1P,NWPK1P,
C     1  APK1N,NWPK1N,APK2P,NWPK2P,APK2N,NWPK2N,SUNCLOCK,
C     1  MAJOR,MINOR,DPUCLK
 1012	format(I10,I7,I10,I3,A2,F7.2,I4,F8.2,I4,F9.2,I4,F8.2,I4,I7,
     1   I8,I5,F11.0)
C
C	ELIMINATE WIDTH = 1, DUE TO ERROR IN PROGRAM
C
	IF(NWPK1P.EQ.1) GO TO 100
	IF(ANGDD.LT.15.) GO TO 100
	NREAD = NREAD+1
C
C	HISTOGRAM OF HEIGHTS
	NH = IFIX(AMIN1(50.*APK1P,200.))
	NH = MAX0(NH,1)
	HIST(NH,1) = HIST(NH,1) + 1.
	NH = IFIX(AMIN1(-50.*APK1N,200.))
	NH = MAX0(NH,1)
	HIST(NH,2) = HIST(NH,2) + 1.
	NH = IFIX(AMIN1(50.*APK2P,200.))
	NH = MAX0(NH,1)
	HIST(NH,3) = HIST(NH,3) + 1.
	NH = IFIX(AMIN1(-50.*APK2N,200.))
	NH = MAX0(NH,1)
	HIST(NH,4) = HIST(NH,4) + 1.
C
C	HISTOGRAM OF WIDTHS
C	HIST(NWPK1P,1) = HIST(NWPK1P,1) + 1.
C	HIST(NWPK1N,2) = HIST(NWPK1N,1) + 1.
C	HIST(NWPK2P,3) = HIST(NWPK2P,1) + 1.
C	HIST(NWPK2N,4) = HIST(NWPK2N,1) + 1.
C
C	HISTOGRAM OF SUNCLOCK,MAJOR,MINOR AND DPUCLOCK
C
C	NH = IFIX(AMIN1(.04*SUNCLOCK,200.))
C	NH = MAX0(NH,1)
C	HIST(NH,1) = HIST(NH,1) + 1.
C	NH = IFIX(AMIN1(.0004*MAJOR,200.))
C	NH = MAX0(NH,1)
C	HIST(NH,2) = HIST(NH,2) + 1.
C	NH = IFIX(AMIN1(.5*MINOR,200.))
C	NH = MAX0(NH,1)
C	HIST(NH,3) = HIST(NH,3) + 1.
C	NH = IFIX(AMIN1(DPUCLK/1.E5,200.))
C	NH = MAX0(NH,1)
C	HIST(NH,4) = HIST(NH,4) + 1.
C
C	HISTOGRAM OF PANGLE, ZANGLE, FCHANGE, ANGDD
C	NH = IFIX(AMIN1(.5*(PANGLE+180.),200.))
C	NH = MAX0(NH,1)
C	HIST(NH,1) = HIST(NH,1) + 1.
C	NH = IFIX(AMIN1(.5*(ZANGLE+180.),200.))
C	NH = MAX0(NH,1)
C	HIST(NH,2) = HIST(NH,2) + 1.
C	NH = IFIX(AMIN1(ANGDD,200.))
C	NH = MAX0(NH,1)
C	HIST(NH,3) = HIST(NH,3) + 1.
C	NH = IFIX(AMIN1(20.*FCHANGE,200.))
C	NH = MAX0(NH,1)
C	HIST(NH,4) = HIST(NH,4) + 1.
C
C	IF(ANGDD.GT.15.) THEN
C	WRITE(80,1011) sceti4,NOEVTT,TMDAY,EVENTT,APK1P,NWPK1P,
C     1  APK1N,NWPK1N,APK2P,NWPK2P,APK2N,NWPK2N,NLAG1,NLAG2,SUNCLOCK,
C     1  PANGLE,ZANGLE,FCHANGE,ANGDD,EPT
C	ENDIF
C
	GO TO 100
 101	PRINT*,'ERROR',SCETI4,EVENTT,DPUCLK
	GO TO 100
C
 200	CONTINUE
	PRINT*,NREAD,' GOOD LINES READ'
	DO N = 1,200
C 	  WRITE(83,*) N,(HIST(N,I),I=1,2)
	  WRITE(83,*) N,(HIST(N,I),I=1,4)
	ENDDO
	STOP
	END
