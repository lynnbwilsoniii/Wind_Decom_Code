	program coil
C
C	CALCULATES AND PLOTS WIND SEARCH COIL TRANSFER F AND NOISE THRESH
C
C   freq  trans(V/nT)  noise(nT/rtHz)  noise(v**2/rtHz)  noise(V/rtHz)
C     40.     .012       1.17E-04       1.98E-12            1.41E-6
C    100.     .03         4.9E-05       2.16E-12            1.47E-6
C    300.     .09         2.9E-05       6.81E-12            2.61E-6
C   1000.     .290       2.18E-05       4.00E-11	    6.32E-6
C   2000.     .6         2.15E-05       1.66E-10            1.29E-5
C   3000.     .750       2.12E-05       2.53E-10            1.59E-5
C   4000.     .7         2.10E-05       2.16E-10            1.47E-5
C   5000.     .57        2.07E-05
C   6000.     .500       2.04E-05       1.04E-10            1.02E-5
C
	COMPLEX Z1,Z2,Z3,Z4,Y2,CGAIN
	COMMON /PLOTDT/ ITERM,NF
 	COMMON /DBLK/ FREQ(300),TRANS(300),PANOIS(300)
	DIMENSION GFREQ(6),GTR(6),GPAN(6)
	DATA GFREQ /1000.,2000.,3000.,4000.,5000.,6000./
	DATA GTR   /.290,.6,.750,.7,.57,.500/
	DATA GPAN  /2.12,2.09,2.07,2.05,2.03,2.01/
C	DATA R1,C1,R2,C2 /49.9E03,.33E-06,499.E03,22.E-12/  !BEFORE 16 DEC 1991
C	DATA R1,C1,R2,C2 /49.9E03,.33E-06,499.E03,1.E-09/   !BEFORE 1430  "
C	DATA R1,C1,R2,C2 /49.9E03,.33E-06,1000.E03,1.E-09/
	DATA R1,C1,R2,C2 /49.9E03,1.E-06,1000.E03,1.E-09/
	DATA TWOPI /6.2831853/
C	DATA ITERM /3/
	DATA ITERM /-5/
C
C	CALCULATE FREQUENCY LIST
C
	FRAT = 10.**(.05)
	FREQ(1) = .1
	DO N = 2,80
	  NF = N
	  FREQ(N) = FREQ(N-1)*FRAT
	ENDDO
C	PRINT*,'FREQ',NF,' =',FREQ(NF)
	PRINT*,'R1,C1,R2,C2,1ST AMP',R1,C1,R2,C2
C
C	CALCULATE ARRAY 'TRANS' OF TRANSFER FUNCTION IN V/nT
C
	DO N = 1,80
	  TRANS(N) = .29*(FREQ(N)/1000.)
	ENDDO
C	MULTIPLY BY EFFECT OF NEW IOWA INPUT CAPS .1 UF FEEDING 2.04 MEG
C
	DO N = 1,80
	  TRANS(N) = TRANS(N)/SQRT(1. + (.78/FREQ(N))**2)
	ENDDO
C
C	CALCULATE NOISE LEVEL IN nT/SQRT(HZ)
C
	DO N = 1,80
C	  APPROXIMATE NOISE BY A/FREQ + B.  THIS IS TOO HIGH FOR CROSSOVER FREQS
	  PANOIS(N) = 1.8E-05 + 1.0E-04*(40./FREQ(N))
C	  PRINT*,'FREQ,NOISE,NT/RTHZ',FREQ(N),PANOIS(N)
	ENDDO
C
	DO N = 1,6
	  NF = NF+1
	  FREQ(NF) = GFREQ(N)
	  TRANS(NF) = GTR(N)
	  PANOIS(NF) = GPAN(N)*1.E-5
	ENDDO
C
C	CALCULATE TRANSFER FUNCTION (VOLTS/NT) WITH FIRST AMPLIFIER GAIN
C
	F1 = 1./TWOPI/R1/C1                      ! INPUT CORNER FREQ
	F2 = 1./TWOPI/R2/C2			 ! OUTPUT CORNER FREQ
	PRINT*,'1ST AMP CORNER FREQUENCIES',F1,F2
	N = NF
	DO N = 1,NF
	  W = TWOPI*FREQ(N)
	  Z1 = CMPLX(R1,-1./W/C1)
	  Y2 = CMPLX(1./R2,W*C2)
	  Z2 = 1./Y2
	  CGAIN = Z2/Z1
	  GAIN = CABS(CGAIN)
C	  PRINT*,'FREQ,CGAIN,GAIN',FREQ(N),CGAIN,GAIN
	  TRANS(N) = TRANS(N)*GAIN
	ENDDO
C
C	CALCULATE NOISE LEVEL IN V/SQRT(HZ)
C
	PANT = 0.
	PANLOW = 0.
	  N = 1
	  PANOIS(N) = PANOIS(N)*TRANS(N)
	DO N = 2,NF
	  PANOIS(N) = PANOIS(N)*TRANS(N)
	  DNOISE = .5*(FREQ(N)-FREQ(N-1))*(PANOIS(N)+PANOIS(N-1))**2
	  PANT = PANT + DNOISE
	  IF(FREQ(N).LT.170.) PANLOW = PANLOW + DNOISE
	ENDDO
	PANRMS = SQRT(PANT)
	PRINT*,'TOTAL PREAMP NOISE, VOLT**2/HZ',PANT,'  RMS=',PANRMS
	PANRMS = SQRT(PANLOW)
	PRINT*,'PREAMP NOISE LT 170 HZ, VOLT**2/HZ',PANLOW,'  RMS=',PANRMS
	CALL FPLOT
	STOP
	END
	SUBROUTINE PARINT(X1,X0,X2,Y1,Y0,Y2,X,Y)
C
C	PARABOLIC INTERPOLATION ON UNIFORMLY SPACED X
C
	AA = X0
	BB = (Y2 - Y1)/(X2 - X1)
	CC = 2.*(X1 + X2 - 2.*X0)/(X2 - X1)**2
	Y = AA + BB*(X-X0) + CC*(X-X0)**2
	RETURN
	END
