	PROGRAM PROCXYZDATA
C
C	READS IN A BUNCH OF CALS AND AVERAGES GAIN AND PHASE
C
	CHARACTER*80 FILE,JUNK
	DIMENSION SPEC(1025,4),PH(1025,4),PHDIFF(1025,4),COUNT(1025)
	DIMENSION PHASE(1025),WT(1025),SPDIFF(1025,4)
	DIMENSION STDX(1025) ,STDY(1025)	
	DIMENSION XDATA(513,8),XX(8)
	DATA COUNT /1025*1.E-8/
	DATA XDATA /4104*0./
C
	DO NN = 1,1025
	  STDX(NN) = -32. - 7.*(NN/1024.)**2 - 12.
	  STDY(NN) = STDX(NN) - 6.
	ENDDO
	FLOW = 30.E3/4096.
C
	OPEN(UNIT=72,FILE='XYZDATA.DAT',STATUS='OLD',READONLY)
	
C
 100	READ(72,1001,END=200) FILE
	PRINT*,FILE
	READ(72,1001) JUNK
	PRINT*,JUNK
 1001	FORMAT(A80,I10)
C
 110	CONTINUE
C	DO NN = 1,1025
	DO NN = 1,512
	  READ(72,*) NPR,(XX(J),J=1,8)
	  IF(NN.EQ.2) PRINT*,NPR,(XX(J),J=1,8)
C	  IF(XX.GT.STDX(NN).AND.YY.GT.STDY(NN)) THEN
C		GUARD AGAINST MISSING EVENTS
C	    IF(XX.LT.-1..AND.YY.LT.-1.) THEN
		COUNT(NN) = COUNT(NN) + 1.
		DO J = 1,8
		  XDATA(NN,J) = XDATA(NN,J) + XX(J)
		ENDDO
C
C		XSPEC(NN) = XSPEC(NN) + XX
C		YSPEC(NN) = YSPEC(NN) + YY
C		XYDIFF(NN) = XYDIFF(NN) + XY
C		YZDIFF(NN) = XYDIFF(NN) + YZ
C		ZXDIFF(NN) = XYDIFF(NN) + ZX
C		PHASEXY(NN) = PHASEXY(NN) + PHXY
C		PHASEYZ(NN) = PHASEYZ(NN) + PHYZ
C		PHASEZX(NN) = PHASEZX(NN) + PHZX
C	    ENDIF
C	  ENDIF
	ENDDO
	GO TO 100
C
 200	CONTINUE
	DO NN = 1,512
	  DO J = 1,8
	    XDATA(NN,J) = XDATA(NN,J)/COUNT(NN)
	  ENDDO
	  PH(NN,1) = ATAN2D(XDATA(NN,2),XDATA(NN,1))
	  PH(NN,2) = ATAN2D(XDATA(NN,4),XDATA(NN,3))
	  PH(NN,3) = ATAN2D(XDATA(NN,6),XDATA(NN,5))
	  PH(NN,4) = ATAN2D(XDATA(NN,8),XDATA(NN,7))
	  PHDIFF(NN,1) = PH(NN,1) - PH(NN,2)
	  IF(PHDIFF(NN,1).GT.180.)  PHDIFF(NN,1) = PHDIFF(NN,1)-360.
	  IF(PHDIFF(NN,1).LE.-180.) PHDIFF(NN,1) = PHDIFF(NN,1)+360.
	  PHDIFF(NN,2) = PH(NN,2) - PH(NN,3)
	  IF(PHDIFF(NN,2).GT.180.)  PHDIFF(NN,2) = PHDIFF(NN,2)-360.
	  IF(PHDIFF(NN,2).LE.-180.) PHDIFF(NN,2) = PHDIFF(NN,2)+360.
	  PHDIFF(NN,3) = PH(NN,3) - PH(NN,1)
	  IF(PHDIFF(NN,3).GT.180.)  PHDIFF(NN,3) = PHDIFF(NN,3)-360.
	  IF(PHDIFF(NN,3).LE.-180.) PHDIFF(NN,3) = PHDIFF(NN,3)+360.
	  SPEC(NN,1) = 10.*ALOG10(XDATA(NN,1)**2 + XDATA(NN,2)**2)
	  SPEC(NN,2) = 10.*ALOG10(XDATA(NN,3)**2 + XDATA(NN,4)**2)
	  SPEC(NN,3) = 10.*ALOG10(XDATA(NN,5)**2 + XDATA(NN,6)**2)
	  SPEC(NN,4) = 10.*ALOG10(XDATA(NN,7)**2 + XDATA(NN,8)**2)
	  SPDIFF(NN,1) = SPEC(NN,1) - SPEC(NN,2)
	  SPDIFF(NN,2) = SPEC(NN,2) - SPEC(NN,3)
	  SPDIFF(NN,3) = SPEC(NN,3) - SPEC(NN,1)
	  SPDIFF(NN,4) = SPEC(NN,4) 
	  WRITE(69,1002) NN,FLOW*NN,COUNT(NN),SPDIFF(NN,1),SPDIFF(NN,2),
     1		SPDIFF(NN,3),PHDIFF(NN,1),PHDIFF(NN,2),PHDIFF(NN,3)
 1002	  FORMAT(I6,F10.3,F6.0,3E12.4,3F7.1)
	ENDDO
C
C	  DO IK = 3,NVAR,2
C	      ISP = ISP+1
C	      SPECT(ISP) = 10.*ALOG10(PDATA(IK)**2 + PDATA(IK+1)**2)-SNORM
C	  ENDDO
C	GNIP = AIMAG(CGAIN)
C	GNRP = CGAIN
C	PHASE = ATAN2(GNIP,GNRP)


C
	STOP
	END
